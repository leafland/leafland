let colorSection=document.querySelector("#color-section"),successMessage=document.querySelector("#success-message"),gradeSizeSelect=document.querySelector("#grade-size-select"),heightSelect=document.querySelector("#height-select"),standardHeightSelect=document.querySelector("#standard-height-select"),gradeSizesDiv=document.querySelector("#grade-sizes"),stockValuesDiv=document.querySelector("#stock-values"),treeQuantity=document.querySelector("#quantity"),treeBotanicalName=document.querySelector(".tree-botanical-name"),treeCommonName=document.querySelector(".tree-common-name"),images=document.querySelector(".images"),mainImage=document.querySelector("#main-image-inner"),addToOrderButton=document.querySelector("#add-product"),treeAttributes=document.querySelector("#tree-attributes"),imageLightbox=document.querySelector("#image-lightbox"),imageLightboxInner=document.querySelector("#image-lightbox-div"),imageLightBoxClose=document.querySelector("#image-lightbox-close"),imageLeftButton=document.querySelector("#image-left-button"),imageRightButton=document.querySelector("#image-right-button"),imagePosition=0,thumbImages=document.querySelectorAll(".thumb-image"),productImage="",maximumQuantityReached=!1,quantityField=document.querySelector("#quantity-field"),wholesalePriceField=document.querySelector("#wholesale-price"),retailPriceField=document.querySelector("#retail-price"),stockTableDiv=document.querySelector("#stock-table-div"),heightValues=0,standardHeightValues=0,productTrees=JSON.parse(localStorage.getItem("trees"));const productAdded=new Event("productAdded");let grades=[],stockData=[],newData=[];async function getProductStockData(){let treeName;treeName=-1!==treeCommonName.textContent.search("serrula")?treeBotanicalName.textContent+" serrula interstem":treeBotanicalName.textContent,grades=await fetch(`https://api.leafland.co.nz/default/get-tree-stock-data?treeName=${treeName.trim().replace(/ã/g,"a").replace(/é/g,"e").replace(/ā/g,"a").replace(/ē/g,"e").replace(/ī/g,"i").replace(/ō/g,"o").replace(/ū/g,"u").replace(/'/g,"").replace(/"/g,"").replace(/\./g,"").replace(/ var /g," ").replace(/ x /g," ").replace(/\(/g,"").replace(/\)/g,"").replace(/\\/g," ").replace(/\//g," ").replace(/ /g,"-").toLowerCase()}`).then(response=>response.json()).then(data=>data).catch(error=>{})}async function createTreeImages(){imageLightBoxClose.addEventListener("click",()=>{document.body.classList.remove("lightbox-open")});let mainImg=document.querySelector(".main-img");productImage=mainImg.src.split("images/trees/")[1].split("?")[0],mainImg.addEventListener("click",()=>{imageLightboxInner.innerHTML=`<img src='${mainImg.src.split("?")[0]}?auto=format&w=1000&q=75' height="1000" width="1000" alt="${mainImg.alt}" srcset="${mainImg.src.split("?")[0]}?auto=format&w=300&q=75 300w, ${mainImg.src.split("?")[0]}?auto=format&w=500&q=75 500w, ${mainImg.src.split("?")[0]}?auto=format&w=700&q=75 700w" sizes="1000px">`,document.body.classList.add("lightbox-open")}),thumbImages.forEach(thumbImage=>{thumbImage.addEventListener("click",e=>{imagePosition=parseInt(thumbImage.dataset.position),e.preventDefault(),mainImg=document.querySelector(".main-img"),mainImg.alt!==thumbImage.alt&&(mainImage.style.setProperty("opacity","0"),mainImage.style.setProperty("visibility","hidden"),setTimeout(()=>{mainImage.innerHTML=`<img src="${thumbImage.src.split("?")[0]}?auto=format&w=500&q=75" height="500" width="500" alt="${thumbImage.alt}" class="main-img" style="opacity: 1;">`,mainImage.style.setProperty("opacity","1"),mainImage.style.setProperty("visibility","visible")},500),mainImage.addEventListener("click",()=>{imageLightboxInner.innerHTML=`<img src="${thumbImage.src.split("?")[0]}?auto=format&w=1000&q=75" height="1000" width="1000" alt="${thumbImage.alt}" srcset="${thumbImage.src.split("?")[0]}?auto=format&w=300&q=75 300w, ${thumbImage.src.split("?")[0]}?auto=format&w=500&q=75 500w, ${thumbImage.src.split("?")[0]}?auto=format&w=700&q=75 700w" sizes="1000px">`,document.body.classList.add("lightbox-open")}))})}),imageLeftButton.addEventListener("click",()=>{imagePosition<=0?imagePosition=parseInt(thumbImages.length)-1:imagePosition--,thumbImages.forEach(thumbImage=>{parseInt(thumbImage.dataset.position)===imagePosition&&(mainImage.style.setProperty("opacity","0"),mainImage.style.setProperty("visibility","hidden"),setTimeout(()=>{mainImage.innerHTML=`<img src="${thumbImage.src.split("?")[0]}?auto=format&w=500&q=75" height="500" width="500" alt="${thumbImage.alt}" class="main-img" style="opacity: 1;">`,mainImage.style.setProperty("opacity","1"),mainImage.style.setProperty("visibility","visible"),mainImage.addEventListener("click",()=>{imageLightboxInner.innerHTML=`<img src="${thumbImage.src.split("?")[0]}?auto=format&w=1000&q=75" height="1000" width="1000" alt="${thumbImage.alt}" srcset="${thumbImage.src.split("?")[0]}?auto=format&w=300&q=75 300w, ${thumbImage.src.split("?")[0]}?auto=format&w=500&q=75 500w, ${thumbImage.src.split("?")[0]}?auto=format&w=700&q=75 700w" sizes="1000px">`,document.body.classList.add("lightbox-open")})},500))})}),imageRightButton.addEventListener("click",()=>{imagePosition>=thumbImages.length-1?imagePosition=0:imagePosition++,thumbImages.forEach(thumbImage=>{parseInt(thumbImage.dataset.position)===imagePosition&&(mainImage.style.setProperty("opacity","0"),mainImage.style.setProperty("visibility","hidden"),setTimeout(()=>{mainImage.innerHTML=`<img src="${thumbImage.src.split("?")[0]}?auto=format&w=500&q=75" height="500" width="500" alt="${thumbImage.alt}" class="main-img" style="opacity: 1;">`,mainImage.style.setProperty("opacity","1"),mainImage.style.setProperty("visibility","visible"),mainImage.addEventListener("click",()=>{imageLightboxInner.innerHTML=`<img src="${thumbImage.src.split("?")[0]}?auto=format&w=1000&q=75" height="1000" width="1000" alt="${thumbImage.alt}" srcset="${thumbImage.src.split("?")[0]}?auto=format&w=300&q=75 300w, ${thumbImage.src.split("?")[0]}?auto=format&w=500&q=75 500w, ${thumbImage.src.split("?")[0]}?auto=format&w=700&q=75 700w" sizes="1000px">`,document.body.classList.add("lightbox-open")})},500))})})}async function createStockValues(){if(0!==grades.length)grades.forEach(grade=>{let gradeSizeValue=document.createElement("span");gradeSizeValue.classList.add("selection-box"),gradeSizeValue.textContent=grade.grade,gradeSizeValue.dataset.value=grade.grade,document.querySelector("#grade-size-selection").appendChild(gradeSizeValue),gradeSizeValue.addEventListener("click",()=>{heightValues=0,standardHeightValues=0,document.querySelector("#average-height-selection").innerHTML="",document.querySelector("#standard-height-selection").innerHTML='<span class="selection-box-disabled">None</span>',document.querySelectorAll(".grade-selection-value-active").forEach(child=>{child.classList.remove("grade-selection-value-active")}),gradeSizeValue.classList.add("grade-selection-value-active"),treeQuantity.value=1,addToOrderButton.disabled=!0,treeQuantity.disabled=!0;for(let i=0;i<grades.length;i++)if(grades[i].grade===gradeSizeValue.dataset.value){for(let j=0;j<grades[i].heights.length;j++){let heightValue=document.createElement("span");""!==grades[i].heights[j].averageHeight?(heightValue.dataset.value=grades[i].heights[j].averageHeight,heightValue.textContent=`${"n/a"===grades[i].heights[j].averageHeight.toLowerCase()?grades[i].heights[j].averageHeight:grades[i].heights[j].averageHeight+"m"}`):(heightValue.value="N/A",heightValue.textContent="N/A"),heightValue.classList.add("selection-box"),document.querySelector("#average-height-selection").appendChild(heightValue),heightValues+=1,heightValue.addEventListener("click",()=>{standardHeightValues=0,quantityField.textContent="0",wholesalePriceField.textContent="$0.00+GST (Wholesale)",retailPriceField.textContent="$0.00+GST (Retail)",document.querySelector("#standard-height-selection").innerHTML="",document.querySelectorAll(".height-selection-value-active").forEach(child=>{child.classList.remove("height-selection-value-active")}),heightValue.classList.add("height-selection-value-active"),createHeights(gradeSizeValue.dataset.value,heightValue.dataset.value)})}quantityField.textContent="0",wholesalePriceField.textContent="$0.00+GST (Wholesale)",retailPriceField.textContent="$0.00+GST (Retail)";break}if(1===heightValues){document.querySelector("#standard-height-selection").innerHTML="";let heightChildren=document.querySelector("#average-height-selection").children;heightChildren[0].classList.add("height-selection-value-active"),createHeights(gradeSizeValue.dataset.value,heightChildren[0].dataset.value)}})}),quantityField.textContent="0",wholesalePriceField.textContent="$0.00+GST (Wholesale)",retailPriceField.textContent="$0.00+GST (Retail)";else{gradeSizesDiv.innerHTML="";let message=document.createElement("p");message.textContent="Currently out of stock.",message.classList.add("bold-up"),gradeSizesDiv.appendChild(message),gradeSizesDiv.style.setProperty("grid-template-columns","1fr"),gradeSizesDiv.style.setProperty("margin-top","0"),stockValuesDiv.style.setProperty("display","none")}}function addTreeToLocalStorage(){productTrees=JSON.parse(localStorage.getItem("trees"));let totalRetailCost=0,totalWholesaleCost=0;if(0===productTrees.length)productTrees.push({botanicalName:treeBotanicalName.textContent,commonName:treeCommonName.textContent,url:window.location.pathname,mainImage:productImage,grade:document.querySelector(".grade-selection-value-active").dataset.value,height:document.querySelector(".height-selection-value-active").dataset.value,quantity:parseInt(treeQuantity.value,10),maxQuantity:parseInt(treeQuantity.max),standardHeight:document.querySelector(".standard-selection-value-active").dataset.value.split("?q=")[0],retailPrice:document.querySelector("#retail-price").textContent.split(".00+GST")[0],wholesalePrice:document.querySelector("#wholesale-price").textContent.split(".00+GST")[0]});else for(let i=0;i<productTrees.length+1;i++){if(i===productTrees.length){productTrees.push({botanicalName:treeBotanicalName.textContent,commonName:treeCommonName.textContent,url:window.location.pathname,mainImage:productImage,grade:document.querySelector(".grade-selection-value-active").dataset.value,height:document.querySelector(".height-selection-value-active").dataset.value,quantity:parseInt(treeQuantity.value,10),maxQuantity:parseInt(treeQuantity.max),standardHeight:document.querySelector(".standard-selection-value-active").dataset.value.split("?q=")[0],retailPrice:document.querySelector("#retail-price").textContent.split(".00+GST")[0],wholesalePrice:document.querySelector("#wholesale-price").textContent.split(".00+GST")[0]});break}if(productTrees[i].quantity=parseInt(productTrees[i].quantity,10),productTrees[i].botanicalName===treeBotanicalName.textContent&&productTrees[i].grade===document.querySelector(".grade-selection-value-active").dataset.value&&productTrees[i].height===document.querySelector(".height-selection-value-active").dataset.value&&productTrees[i].standardHeight===document.querySelector(".standard-selection-value-active").dataset.value.split("?q=")[0]){productTrees[i].quantity+=parseInt(treeQuantity.value,10),productTrees[i].quantity>=productTrees[i].maxQuantity&&(productTrees[i].quantity=productTrees[i].maxQuantity,maximumQuantityReached=!0);break}}productTrees.forEach(tree=>{totalRetailCost+=tree.quantity*parseInt(tree.retailPrice.slice(1),10),totalWholesaleCost+=tree.quantity*parseInt(tree.wholesalePrice.slice(1),10)}),localStorage.setItem("trees",JSON.stringify(productTrees)),localStorage.setItem("totalRetailCost",JSON.stringify(totalRetailCost)),localStorage.setItem("totalWholesaleCost",JSON.stringify(totalWholesaleCost))}function createHeights(grade,height){treeQuantity.value=1,addToOrderButton.disabled=!0,treeQuantity.disabled=!0;for(let i=0;i<grades.length;i++)if(grades[i].grade===grade){let noStandardHeightQuantity=0;for(let j=0;j<grades[i].heights.length;j++)if(grades[i].heights[j].averageHeight===height){for(let k=0;k<grades[i].heights[j].standardHeights.length;k++){let standardHeightValue=document.createElement("span");""!==grades[i].heights[j].standardHeights[k].standardHeight.trim()&&"bushy"!==grades[i].heights[j].standardHeights[k].standardHeight.toLowerCase().trim()&&"l/w"!==grades[i].heights[j].standardHeights[k].standardHeight.toLowerCase().trim()&&"lw"!==grades[i].heights[j].standardHeights[k].standardHeight.toLowerCase().trim()&&"ct"!==grades[i].heights[j].standardHeights[k].standardHeight.toLowerCase().trim()?(standardHeightValue.dataset.value=`${grades[i].heights[j].standardHeights[k].standardHeight}?q=${grades[i].heights[j].standardHeights[k].quantity}&wp=${grades[i].heights[j].standardHeights[k].wholesalePrice}&rp=${grades[i].heights[j].standardHeights[k].retailPrice}`,null!==grades[i].heights[j].standardHeights[k].standardHeight.match(/\d+/g)?standardHeightValue.textContent=grades[i].heights[j].standardHeights[k].standardHeight+"m":standardHeightValue.textContent=grades[i].heights[j].standardHeights[k].standardHeight,standardHeightValue.classList.add("selection-box"),document.querySelector("#standard-height-selection").appendChild(standardHeightValue),standardHeightValues+=1,standardHeightValue.addEventListener("click",()=>{standardHeightValues=0,document.querySelectorAll(".standard-selection-value-active").forEach(child=>{child.classList.remove("standard-selection-value-active")}),standardHeightValue.classList.add("standard-selection-value-active");let parameters=standardHeightValue.dataset.value.split("?")[1],standardQuantity=parameters.split("&")[0],wholesalePrice=parameters.split("&")[1],retailPrice=parameters.split("&")[2];quantityField.textContent=`${standardQuantity.split("q=")[1]}`,wholesalePriceField.textContent=`${wholesalePrice.split("wp=")[1]}.00+GST (Wholesale)`,retailPriceField.textContent=`${retailPrice.split("rp=")[1]}.00+GST (Retail)`,0===parseInt(standardQuantity.split("q=")[1])?(addToOrderButton.disabled=!0,treeQuantity.disabled=!0,treeQuantity.value=1):(addToOrderButton.disabled=!1,treeQuantity.disabled=!1,treeQuantity.max=parseInt(standardQuantity.split("q=")[1]),treeQuantity.onchange=function(){this.value<1?this.value=1:this.value>parseInt(standardQuantity.split("q=")[1])&&(this.value=parseInt(standardQuantity.split("q=")[1]))})})):"column"!==grades[i].heights[j].standardHeights[k].standardHeight.toLowerCase().trim()&&(standardHeightValue=document.createElement("span"),standardHeightValue.textContent="None",noStandardHeightQuantity+=grades[i].heights[j].standardHeights[k].quantity,standardHeightValue.dataset.value=`None?q=${noStandardHeightQuantity}&wp=${grades[i].heights[j].standardHeights[k].wholesalePrice}&rp=${grades[i].heights[j].standardHeights[k].retailPrice}`,standardHeightValue.classList.add("selection-box"),document.querySelector("#standard-height-selection").appendChild(standardHeightValue),standardHeightValues+=1,standardHeightValue.addEventListener("click",()=>{standardHeightValues=0,document.querySelectorAll(".standard-selection-value-active").forEach(child=>{child.classList.remove("standard-selection-value-active")}),standardHeightValue.classList.add("standard-selection-value-active");let parameters=standardHeightValue.dataset.value.split("?")[1],standardQuantity=parameters.split("&")[0],wholesalePrice=parameters.split("&")[1],retailPrice=parameters.split("&")[2];quantityField.textContent=`${standardQuantity.split("q=")[1]}`,wholesalePriceField.textContent=`${wholesalePrice.split("wp=")[1]}.00+GST (Wholesale)`,retailPriceField.textContent=`${retailPrice.split("rp=")[1]}.00+GST (Retail)`,0===parseInt(standardQuantity.split("q=")[1])?(addToOrderButton.disabled=!0,treeQuantity.disabled=!0,treeQuantity.value=1):(addToOrderButton.disabled=!1,treeQuantity.disabled=!1,treeQuantity.max=parseInt(standardQuantity.split("q=")[1]),treeQuantity.onchange=function(){this.value<1?this.value=1:this.value>parseInt(standardQuantity.split("q=")[1])&&(this.value=parseInt(standardQuantity.split("q=")[1]))})}))}break}break}if(1===standardHeightValues){let standardChildren=document.querySelector("#standard-height-selection").children;standardChildren[0].classList.add("standard-selection-value-active");let parameters=standardChildren[0].dataset.value.split("?")[1],standardQuantity=parameters.split("&")[0],wholesalePrice=parameters.split("&")[1],retailPrice=parameters.split("&")[2];quantityField.textContent=`${standardQuantity.split("q=")[1]}`,wholesalePriceField.textContent=`${wholesalePrice.split("wp=")[1]}.00+GST (Wholesale)`,retailPriceField.textContent=`${retailPrice.split("rp=")[1]}.00+GST (Retail)`,0===parseInt(standardQuantity.split("q=")[1])?(addToOrderButton.disabled=!0,treeQuantity.disabled=!0,treeQuantity.value=1):(addToOrderButton.disabled=!1,treeQuantity.disabled=!1,treeQuantity.max=parseInt(standardQuantity.split("q=")[1]),treeQuantity.onchange=function(){this.value<1?this.value=1:this.value>parseInt(standardQuantity.split("q=")[1])&&(this.value=parseInt(standardQuantity.split("q=")[1]))})}}async function createStockTable(){let heading=[];heading=document.body.classList.contains("loggedIn")?["GRADE","$RETAIL","$WHOLESALE","HEIGHT (m)","STANDARD HEIGHT (m)","READY","IN PRODUCTION"]:["GRADE","$RETAIL","HEIGHT (m)","STANDARD HEIGHT (m)","READY","IN PRODUCTION"],newData=stockData.filter(item=>{let testItem;return item[0].trim().replace(/ã/g,"a").replace(/é/g,"e").replace(/ā/g,"a").replace(/ē/g,"e").replace(/ī/g,"i").replace(/ō/g,"o").replace(/ū/g,"u").replace(/'/g,"").replace(/"/g,"").replace(/\./g,"").replace(/ var /g," ").replace(/ x /g," ").replace(/\(/g,"").replace(/\)/g,"").replace(/\\/g," ").replace(/\//g," ").replace(/ /g,"-").toLowerCase()===treeBotanicalName.textContent.trim().replace(/ã/g,"a").replace(/é/g,"e").replace(/ā/g,"a").replace(/ē/g,"e").replace(/ī/g,"i").replace(/ō/g,"o").replace(/ū/g,"u").replace(/'/g,"").replace(/"/g,"").replace(/\./g,"").replace(/ var /g," ").replace(/ x /g," ").replace(/\(/g,"").replace(/\)/g,"").replace(/\\/g," ").replace(/\//g," ").replace(/ /g,"-").toLowerCase()});let table=document.createElement("table");if(newData.length>0){for(let i=0;i<newData.length;i++){if(0===i){let row=document.createElement("tr");heading.forEach(item=>{let cell=document.createElement("th");cell.textContent=item,row.append(cell)}),table.append(row)}let row=document.createElement("tr");for(let j=0;j<10;j++)if(document.body.classList.contains("loggedIn")){if(0!==j&&1!==j&&4!==j){let cell=document.createElement("td");cell.textContent=newData[i][j],row.append(cell)}}else if(0!==j&&1!==j&&4!==j&&5!==j){let cell=document.createElement("td");cell.textContent=newData[i][j],row.append(cell)}table.append(row)}stockTableDiv.append(table)}else stockTableDiv.innerHTML='<p class="bold-up">Currently out of stock.</p>',stockTableDiv.style.setProperty("border","none")}function addEventListeners(){window.addEventListener("storage",(function(event){"trees"===event.key&&(productTrees=JSON.parse(localStorage.getItem(event.key)))})),addToOrderButton.addEventListener("click",()=>{addTreeToLocalStorage(),window.dispatchEvent(productAdded),maximumQuantityReached?(document.querySelector("#success-message-text").innerHTML="You tried adding more trees than we have in stock. Order quantity has been set to the maximum quantity.",maximumQuantityReached=!1):document.querySelector("#success-message-text").innerHTML=`${quantity.value}<span class="lowercase">x</span> ${document.querySelector(".grade-selection-value-active").dataset.value} ${treeBotanicalName.textContent} ${""!==treeCommonName.textContent?'(<span class="accent-color">'+treeCommonName.textContent+"</span>)":""} added to order.`,successMessage.style.setProperty("opacity","1"),successMessage.style.setProperty("visibility","visible"),setTimeout(()=>{successMessage.style.setProperty("opacity","0"),successMessage.style.setProperty("visibility","hidden")},4e3)}),document.querySelector("#open-stock-table").addEventListener("click",()=>{document.body.classList.add("stock-table-open")}),document.querySelector("#stock-table-close").addEventListener("click",()=>{document.body.classList.remove("stock-table-open")})}window.addEventListener("loginUpdated",()=>{!async function init(){addEventListeners(),await createTreeImages(),await getProductStockData();let outOfStock=!1;gradeLoop:for(let i=0;i<grades.length;i++)for(let j=0;j<grades[i].heights.length;j++)for(let k=0;k<grades[i].heights[j].standardHeights.length;k++){if(0!==parseInt(grades[i].heights[j].standardHeights[k].quantity,10)){outOfStock=!1;break gradeLoop}outOfStock=!(grades[i].heights[j].standardHeights.length>1)||k!==grades[i].heights[j].standardHeights.length-1}if(outOfStock){gradeSizesDiv.innerHTML="";let message=document.createElement("p");message.textContent="Currently out of stock.",message.classList.add("bold-up"),gradeSizesDiv.appendChild(message),gradeSizesDiv.style.setProperty("grid-template-columns","1fr"),gradeSizesDiv.style.setProperty("margin-top","0"),stockValuesDiv.style.setProperty("display","none")}else await createStockValues();stockData=await fetch("https://api.leafland.co.nz/default/get-stock-data-file?type=list").then(response=>response.json()).catch(error=>{}),""!==treeCommonName.textContent?document.querySelector("#tree-name-content").textContent=`${treeBotanicalName.textContent} (${treeCommonName.textContent})`:document.querySelector("#tree-name-content").textContent=`${treeBotanicalName.textContent}`,await createStockTable()}()});