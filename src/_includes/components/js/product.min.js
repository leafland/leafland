let colorSection=document.querySelector("#color-section"),successMessage=document.querySelector("#success-message"),gradeSizeSelect=document.querySelector("#grade-size-select"),heightSelect=document.querySelector("#height-select"),standardHeightSelect=document.querySelector("#standard-height-select"),gradeSizesDiv=document.querySelector("#grade-sizes"),stockValuesDiv=document.querySelector("#stock-values"),treeQuantity=document.querySelector("#quantity"),treeBotanicalName=document.querySelector(".tree-botanical-name"),treeCommonName=document.querySelector(".tree-common-name"),images=document.querySelector(".images"),mainImage=document.querySelector("#main-image-inner"),addToOrderButton=document.querySelector("#add-product"),treeAttributes=document.querySelector("#tree-attributes"),imageLightbox=document.querySelector("#image-lightbox"),imageLightboxInner=document.querySelector("#image-lightbox-div"),imageLightBoxClose=document.querySelector("#image-lightbox-close"),comingOn=document.querySelector("#coming-on"),imageLeftButton=document.querySelector("#image-left-button"),imageRightButton=document.querySelector("#image-right-button"),imagePosition=0,thumbImages=document.querySelectorAll(".thumb-image"),productStockData=[],productImage="",maximumQuantityReached=!1,productTrees=JSON.parse(localStorage.getItem("trees"));const productAdded=new Event("productAdded");let grades=[];async function getProductStockData(){productStockData=await fetch("https://api.leafland.co.nz/default/get-stock-data-file").then(response=>response.json()).then(data=>data).catch(error=>{});for(let i=0;i<productStockData.length;i++)"serrula interstem"===treeCommonName.textContent.toLowerCase()?`${treeBotanicalName.textContent} serrula interstem`.replace(/'/g,"").replace(/"/g,"").replace(/ var. /g," ").replace(/ x /g," ").replace(/\(/g,"").replace(/\)/g,"").toLowerCase().trim()!==productStockData[i][0].replace(/'/g,"").replace(/"/g,"").replace(/ var. /g," ").replace(/ x /g," ").replace(/\(/g,"").replace(/\)/g,"").toLowerCase().trim()&&(productStockData.splice(i,1),i--):treeBotanicalName.textContent.replace(/'/g,"").replace(/"/g,"").replace(/ var. /g," ").replace(/ x /g," ").toLowerCase().trim()!==productStockData[i][0].replace(/'/g,"").replace(/"/g,"").replace(/ var. /g," ").replace(/ x /g," ").toLowerCase().trim()&&(productStockData.splice(i,1),i--)}async function createTreeImages(){imageLightBoxClose.addEventListener("click",()=>{document.body.classList.remove("lightbox-open")});let mainImg=document.querySelector(".main-img");productImage=mainImg.src.split("images/trees/")[1].split("?")[0],mainImg.addEventListener("click",()=>{imageLightboxInner.innerHTML=`<img src='${mainImg.src.split("?")[0]}?tr=w-1000,q-75,pr-true,f-auto' height="1000" width="1000" alt="${mainImg.alt}" srcset="${mainImg.src.split("?")[0]}?tr=w-300,q-75,pr-true,f-auto 300w, ${mainImg.src.split("?")[0]}?tr=w-500,q-75,pr-true,f-auto 500w, ${mainImg.src.split("?")[0]}?tr=w-700w,q-75,pr-true,f-auto 700w" sizes="1000px">`,document.body.classList.add("lightbox-open")}),thumbImages.forEach(thumbImage=>{thumbImage.addEventListener("click",e=>{imagePosition=parseInt(thumbImage.dataset.position),e.preventDefault(),mainImg=document.querySelector(".main-img"),mainImg.alt!==thumbImage.alt&&(mainImage.style.setProperty("opacity","0"),mainImage.style.setProperty("visibility","hidden"),setTimeout(()=>{mainImage.innerHTML=`<img src="${thumbImage.src.split("?")[0]}?tr=w-500,q-75,pr-true,f-auto" height="500" width="500" alt="${thumbImage.alt}" class="main-img" style="opacity: 1;">`,mainImage.style.setProperty("opacity","1"),mainImage.style.setProperty("visibility","visible")},500),mainImage.addEventListener("click",()=>{imageLightboxInner.innerHTML=`<img src="${thumbImage.src.split("?")[0]}?tr=w-1000,q-75,pr-true,f-auto" height="1000" width="1000" alt="${thumbImage.alt}" srcset="${thumbImage.src.split("?")[0]}?tr=w-300,q-75,pr-true,f-auto 300w, ${thumbImage.src.split("?")[0]}?tr=w-500,q-75,pr-true,f-auto 500w, ${thumbImage.src.split("?")[0]}?tr=w-700w,q-75,pr-true,f-auto 700w" sizes="1000px">`,document.body.classList.add("lightbox-open")}))})}),imageLeftButton.addEventListener("click",()=>{imagePosition<=0?imagePosition=parseInt(thumbImages.length)-1:imagePosition--,thumbImages.forEach(thumbImage=>{parseInt(thumbImage.dataset.position)===imagePosition&&(mainImage.style.setProperty("opacity","0"),mainImage.style.setProperty("visibility","hidden"),setTimeout(()=>{mainImage.innerHTML=`<img src="${thumbImage.src.split("?")[0]}?tr=w-500,q-75,pr-true,f-auto" height="500" width="500" alt="${thumbImage.alt}" class="main-img" style="opacity: 1;">`,mainImage.style.setProperty("opacity","1"),mainImage.style.setProperty("visibility","visible"),mainImage.addEventListener("click",()=>{imageLightboxInner.innerHTML=`<img src="${thumbImage.src.split("?")[0]}?tr=w-1000,q-75,pr-true,f-auto" height="1000" width="1000" alt="${thumbImage.alt}" srcset="${thumbImage.src.split("?")[0]}?tr=w-300,q-75,pr-true,f-auto 300w, ${thumbImage.src.split("?")[0]}?tr=w-500,q-75,pr-true,f-auto 500w, ${thumbImage.src.split("?")[0]}?tr=w-700w,q-75,pr-true,f-auto 700w" sizes="1000px">`,document.body.classList.add("lightbox-open")})},500))})}),imageRightButton.addEventListener("click",()=>{imagePosition>=thumbImages.length-1?imagePosition=0:imagePosition++,thumbImages.forEach(thumbImage=>{parseInt(thumbImage.dataset.position)===imagePosition&&(mainImage.style.setProperty("opacity","0"),mainImage.style.setProperty("visibility","hidden"),setTimeout(()=>{mainImage.innerHTML=`<img src="${thumbImage.src.split("?")[0]}?tr=w-500,q-75,pr-true,f-auto" height="500" width="500" alt="${thumbImage.alt}" class="main-img" style="opacity: 1;">`,mainImage.style.setProperty("opacity","1"),mainImage.style.setProperty("visibility","visible"),mainImage.addEventListener("click",()=>{imageLightboxInner.innerHTML=`<img src="${thumbImage.src.split("?")[0]}?tr=w-1000,q-75,pr-true,f-auto" height="1000" width="1000" alt="${thumbImage.alt}" srcset="${thumbImage.src.split("?")[0]}?tr=w-300,q-75,pr-true,f-auto 300w, ${thumbImage.src.split("?")[0]}?tr=w-500,q-75,pr-true,f-auto 500w, ${thumbImage.src.split("?")[0]}?tr=w-700w,q-75,pr-true,f-auto 700w" sizes="1000px">`,document.body.classList.add("lightbox-open")})},500))})})}async function createStockValues(){if(0!==productStockData.length){for(let i=0;i<productStockData.length;i++)if(0===grades.length)grades.push({grade:productStockData[i][2],heights:[{averageHeight:""===productStockData[i][6]?"N/A":productStockData[i][6],standardHeights:[{quantity:parseInt(productStockData[i][8],10),standardHeight:productStockData[i][7],retailPrice:productStockData[i][3].replace(/,/g,""),wholesalePrice:productStockData[i][5].replace(/,/g,"")}]}],comingOn:parseInt(productStockData[i][9])});else for(let j=0;j<grades.length+1;j++){if(j===grades.length){grades.push({grade:productStockData[i][2],heights:[{averageHeight:""===productStockData[i][6]?"N/A":productStockData[i][6],standardHeights:[{quantity:parseInt(productStockData[i][8],10),standardHeight:productStockData[i][7],retailPrice:productStockData[i][3].replace(/,/g,""),wholesalePrice:productStockData[i][5].replace(/,/g,"")}]}],comingOn:parseInt(productStockData[i][9])});break}if(grades[j].grade.toLowerCase()===productStockData[i][2].toLowerCase()){grades[j].comingOn+=parseInt(productStockData[i][9]);for(let k=0;k<grades[j].heights.length+1;k++){if(k===grades[j].heights.length){grades[j].heights.push({averageHeight:""===productStockData[i][6]?"N/A":productStockData[i][6],standardHeights:[{quantity:parseInt(productStockData[i][8],10),standardHeight:productStockData[i][7],retailPrice:productStockData[i][3].replace(/,/g,""),wholesalePrice:productStockData[i][5].replace(/,/g,"")}]});break}if(grades[j].heights[k].averageHeight===productStockData[i][6]||"N/A"===grades[j].heights[k].averageHeight&&""===productStockData[i][6]){for(let l=0;l<grades[j].heights[k].standardHeights.length+1;l++){if(l===grades[j].heights[k].standardHeights.length){grades[j].heights[k].standardHeights.push({quantity:parseInt(productStockData[i][8],10),standardHeight:productStockData[i][7],retailPrice:productStockData[i][3].replace(/,/g,""),wholesalePrice:productStockData[i][5].replace(/,/g,"")});break}if(grades[j].heights[k].standardHeights[l].standardHeight===productStockData[i][7]){grades[j].heights[k].standardHeights[l].quantity=parseInt(grades[j].heights[k].standardHeights[l].quantity,10),grades[j].heights[k].standardHeights[l].quantity+=parseInt(productStockData[i][8],10);break}}break}}break}}grades.forEach(grade=>{let selectValue=document.createElement("option");selectValue.value=grade.grade,selectValue.textContent=grade.grade,gradeSizeSelect.appendChild(selectValue),0===parseInt(grade.comingOn)||Number.isNaN(grade.comingOn)||(comingOn.innerHTML+=`<span class="info-pill">${grade.grade} - ${grade.comingOn} total</span>`)}),17===comingOn.textContent.length&&(comingOn.innerHTML+=' <span class="info-pill">None</span>');let quantity=document.createElement("p");quantity.innerHTML='<span class="stock-value-title">Quantity in stock:</span> <span class="info-pill">0</span>';let stockPrice=document.createElement("p");stockPrice.innerHTML='<span class="stock-value-title">Price per tree:</span> <span id="wholesale-price" class="info-pill">$0.00+GST (Wholesale)</span> <span id="retail-price" class="info-pill">$0.00+GST (Retail)</span>',stockValuesDiv.appendChild(quantity),stockValuesDiv.appendChild(stockPrice)}else{gradeSizesDiv.innerHTML="";let message=document.createElement("p");message.textContent="Currently out of stock.",message.classList.add("bold-up"),gradeSizesDiv.appendChild(message),gradeSizesDiv.style.setProperty("grid-template-columns","1fr"),gradeSizesDiv.style.setProperty("margin-top","0"),document.querySelector("#grade-sizes-heading").style.setProperty("display","none"),document.querySelector("#success-message").style.setProperty("display","none"),stockValuesDiv.style.setProperty("display","none"),document.querySelector("#coming-on").style.setProperty("display","none")}}function addTreeToLocalStorage(){productTrees=JSON.parse(localStorage.getItem("trees"));let totalRetailCost=0,totalWholesaleCost=0;if(0===productTrees.length)productTrees.push({botanicalName:treeBotanicalName.textContent,commonName:treeCommonName.textContent,url:window.location.pathname,mainImage:productImage,grade:gradeSizeSelect.value,averageHeight:heightSelect.value,quantity:parseInt(treeQuantity.value,10),maxQuantity:treeQuantity.max,standardHeight:standardHeightSelect.value.split("?q=")[0],retailPrice:document.querySelector("#retail-price").textContent.split(".00+GST")[0],wholesalePrice:document.querySelector("#wholesale-price").textContent.split(".00+GST")[0]});else for(let i=0;i<productTrees.length+1;i++){if(i===productTrees.length){productTrees.push({botanicalName:treeBotanicalName.textContent,commonName:treeCommonName.textContent,url:window.location.pathname,mainImage:productImage,grade:gradeSizeSelect.value,averageHeight:heightSelect.value,quantity:parseInt(treeQuantity.value,10),maxQuantity:treeQuantity.max,standardHeight:standardHeightSelect.value.split("?q=")[0],retailPrice:document.querySelector("#retail-price").textContent.split(".00+GST")[0],wholesalePrice:document.querySelector("#wholesale-price").textContent.split(".00+GST")[0]});break}if(productTrees[i].quantity=parseInt(productTrees[i].quantity,10),productTrees[i].botanicalName===treeBotanicalName.textContent&&productTrees[i].grade===gradeSizeSelect.value&&productTrees[i].averageHeight===heightSelect.value&&productTrees[i].standardHeight===standardHeightSelect.value.split("?q=")[0]){productTrees[i].quantity+=parseInt(treeQuantity.value,10),productTrees[i].quantity>productTrees[i].maxQuantity&&(productTrees[i].quantity=productTrees[i].maxQuantity,maximumQuantityReached=!0);break}}productTrees.forEach(tree=>{totalRetailCost+=tree.quantity*parseInt(tree.retailPrice.slice(1),10),totalWholesaleCost+=tree.quantity*parseInt(tree.wholesalePrice.slice(1),10)}),localStorage.setItem("trees",JSON.stringify(productTrees)),localStorage.setItem("totalRetailCost",JSON.stringify(totalRetailCost)),localStorage.setItem("totalWholesaleCost",JSON.stringify(totalWholesaleCost))}function addEventListeners(){window.addEventListener("storage",(function(event){"trees"===event.key&&(productTrees=JSON.parse(localStorage.getItem(event.key)))})),addToOrderButton.addEventListener("click",()=>{addTreeToLocalStorage(),window.dispatchEvent(productAdded),maximumQuantityReached?(document.querySelector("#success-message-text").innerHTML="You tried adding more trees than we have in stock. Order quantity has been set to the maximum quantity.",maximumQuantityReached=!1):document.querySelector("#success-message-text").innerHTML=`${quantity.value}<span class="lowercase">x</span> ${gradeSizeSelect.value} ${treeBotanicalName.textContent} ${""!==treeCommonName.textContent?'(<span class="accent-color">'+treeCommonName.textContent+"</span>)":""} added to order.`,successMessage.style.setProperty("opacity","1"),successMessage.style.setProperty("visibility","visible"),successMessage.style.setProperty("z-index","10"),setTimeout(()=>{successMessage.style.setProperty("opacity","0"),successMessage.style.setProperty("visibility","hidden"),successMessage.style.setProperty("z-index","-1")},4e3)}),gradeSizeSelect.addEventListener("change",event=>{stockValuesDiv.innerHTML="",heightSelect.innerHTML="",standardHeightSelect.innerHTML="",treeQuantity.value=1,addToOrderButton.disabled=!0,treeQuantity.disabled=!0,standardHeightSelect.disabled=!0,heightSelect.disabled=!1,heightSelect.innerHTML="<option selected disabled hidden>Select height</option>",standardHeightSelect.innerHTML="<option selected disabled hidden>Select height</option>";for(let i=0;i<grades.length;i++)if(grades[i].grade===event.target.value.split("-0")[0]){let noStandardHeightQuantity=0;for(let j=0;j<grades[i].heights.length;j++){let heightValue=document.createElement("option");""!==grades[i].heights[j].averageHeight?(heightValue.value=grades[i].heights[j].averageHeight,heightValue.textContent=`${"n/a"===grades[i].heights[j].averageHeight.toLowerCase()?grades[i].heights[j].averageHeight:grades[i].heights[j].averageHeight+"m"}`):(heightValue.value="N/A",heightValue.textContent="N/A"),heightSelect.appendChild(heightValue)}let firstValueNone=!1;for(let j=0;j<grades[i].heights[0].standardHeights.length;j++){let standardHeightValue=document.createElement("option");""!==grades[i].heights[0].standardHeights[j].standardHeight.trim()&&"bushy"!==grades[i].heights[0].standardHeights[j].standardHeight.toLowerCase().trim()&&"l/w"!==grades[i].heights[0].standardHeights[j].standardHeight.toLowerCase().trim()&&"lw"!==grades[i].heights[0].standardHeights[j].standardHeight.toLowerCase().trim()&&"ct"!==grades[i].heights[0].standardHeights[j].standardHeight.toLowerCase().trim()?(standardHeightValue.value=`${grades[i].heights[0].standardHeights[j].standardHeight}?q=${grades[i].heights[0].standardHeights[j].quantity}`,null!==grades[i].heights[0].standardHeights[j].standardHeight.match(/\d+/g)?standardHeightValue.textContent=grades[i].heights[0].standardHeights[j].standardHeight+"m":standardHeightValue.textContent=grades[i].heights[0].standardHeights[j].standardHeight,standardHeightSelect.appendChild(standardHeightValue)):"column"!==grades[i].heights[0].standardHeights[j].standardHeight.toLowerCase().trim()&&(0===j&&(firstValueNone=!0),noStandardHeightQuantity+=grades[i].heights[0].standardHeights[j].quantity)}let standardHeightValue=document.createElement("option");standardHeightValue.value=`None?q=${noStandardHeightQuantity}`,standardHeightValue.textContent="None",standardHeightSelect.appendChild(standardHeightValue);let quantity=document.createElement("p");quantity.innerHTML='<span class="stock-value-title">Quantity in stock:</span> <span class="info-pill">0</span>';let stockPrice=document.createElement("p");stockPrice.innerHTML='<span class="stock-value-title">Price per tree:</span> <span id="wholesale-price" class="info-pill">$0.00+GST (Wholesale)</span> <span id="retail-price" class="info-pill">$0.00+GST (Retail)</span>',stockValuesDiv.appendChild(quantity),stockValuesDiv.appendChild(stockPrice);break}}),heightSelect.addEventListener("change",event=>{let standardHeightValue,noneRetailPrice,noneWholesalePrice;stockValuesDiv.innerHTML="",standardHeightSelect.innerHTML="",treeQuantity.value=1,addToOrderButton.disabled=!0,treeQuantity.disabled=!0,standardHeightSelect.disabled=!1,standardHeightSelect.innerHTML="<option selected disabled hidden>Select height</option>";for(let i=0;i<grades.length;i++)if(grades[i].grade===gradeSizeSelect.value){let noStandardHeightQuantity=0;for(let j=0;j<grades[i].heights.length;j++)if(grades[i].heights[j].averageHeight===event.target.value){let noneExists=!1;for(let k=0;k<grades[i].heights[j].standardHeights.length;k++){let standardHeightValue=document.createElement("option");""!==grades[i].heights[j].standardHeights[k].standardHeight.trim()&&"bushy"!==grades[i].heights[j].standardHeights[k].standardHeight.toLowerCase().trim()&&"l/w"!==grades[i].heights[j].standardHeights[k].standardHeight.toLowerCase().trim()&&"lw"!==grades[i].heights[j].standardHeights[k].standardHeight.toLowerCase().trim()&&"ct"!==grades[i].heights[j].standardHeights[k].standardHeight.toLowerCase().trim()?(standardHeightValue.value=`${grades[i].heights[j].standardHeights[k].standardHeight}?q=${grades[i].heights[j].standardHeights[k].quantity}&wp=${grades[i].heights[j].standardHeights[k].wholesalePrice}&rp=${grades[i].heights[j].standardHeights[k].retailPrice}`,null!==grades[i].heights[j].standardHeights[k].standardHeight.match(/\d+/g)?standardHeightValue.textContent=grades[i].heights[j].standardHeights[k].standardHeight+"m":standardHeightValue.textContent=grades[i].heights[j].standardHeights[k].standardHeight,standardHeightSelect.appendChild(standardHeightValue)):"column"!==grades[i].heights[j].standardHeights[k].standardHeight.toLowerCase().trim()&&(noneExists=!0,standardHeightValue=document.createElement("option"),standardHeightValue.textContent="None",noStandardHeightQuantity+=grades[i].heights[j].standardHeights[k].quantity,standardHeightValue.value=`None?q=${noStandardHeightQuantity}&wp=${grades[i].heights[j].standardHeights[k].wholesalePrice}&rp=${grades[i].heights[j].standardHeights[k].retailPrice}`,standardHeightSelect.appendChild(standardHeightValue),noneRetailPrice=grades[i].heights[j].standardHeights[k].retailPrice,noneWholesalePrice=grades[i].heights[j].standardHeights[k].wholesalePrice)}for(let i=0;i<standardHeightSelect.length;i++){if(-1!==standardHeightSelect.options[i].value.search("None")&&2===standardHeightSelect.length){standardHeightSelect.remove(0);let quantity=document.createElement("p");quantity.innerHTML=`<span class="stock-value-title">Quantity in stock:</span> <span class="info-pill">${noStandardHeightQuantity}</span>`;let stockPrice=document.createElement("p");stockPrice.innerHTML=`<span class="stock-value-title">Price per tree:</span> <span id="wholesale-price" class="info-pill">${noneWholesalePrice}.00+GST (Wholesale)</span> <span id="retail-price" class="info-pill">${noneRetailPrice}.00+GST (Retail)</span>`,stockValuesDiv.innerHTML="",stockValuesDiv.appendChild(quantity),stockValuesDiv.appendChild(stockPrice),0===noStandardHeightQuantity?(addToOrderButton.disabled=!0,treeQuantity.disabled=!0,treeQuantity.value=1):(addToOrderButton.disabled=!1,treeQuantity.disabled=!1,treeQuantity.max=noStandardHeightQuantity,treeQuantity.onchange=function(){this.value<1?this.value=1:this.value>noStandardHeightQuantity&&(this.value=noStandardHeightQuantity)});break}{let quantity=document.createElement("p");quantity.innerHTML='<span class="stock-value-title">Quantity in stock:</span> <span class="info-pill">0</span>';let stockPrice=document.createElement("p");stockPrice.innerHTML='<span class="stock-value-title">Price per tree:</span> <span id="wholesale-price" class="info-pill">$0.00+GST (Wholesale)</span> <span id="retail-price" class="info-pill">$0.00+GST (Retail)</span>',stockValuesDiv.innerHTML="",stockValuesDiv.appendChild(quantity),stockValuesDiv.appendChild(stockPrice)}}break}break}}),standardHeightSelect.addEventListener("change",event=>{stockValuesDiv.innerHTML="",treeQuantity.value=1;let standardHeight=event.target.value.split("?")[0],parameters=event.target.value.split("?")[1],standardQuantity=parameters.split("&")[0],wholesalePrice=parameters.split("&")[1],retailPrice=parameters.split("&")[2],quantity=document.createElement("p");quantity.innerHTML=`<span class="stock-value-title">Quantity in stock:</span> <span class="info-pill">${standardQuantity.split("q=")[1]}</span>`;let stockPrice=document.createElement("p");stockPrice.innerHTML=`<span class="stock-value-title">Price per tree:</span> <span id="wholesale-price" class="info-pill">${wholesalePrice.split("wp=")[1]}.00+GST (Wholesale)</span> <span id="retail-price" class="info-pill">${retailPrice.split("rp=")[1]}.00+GST (Retail)</span>`,stockValuesDiv.appendChild(quantity),stockValuesDiv.appendChild(stockPrice),0===parseInt(standardQuantity.split("q=")[1])?(addToOrderButton.disabled=!0,treeQuantity.disabled=!0,treeQuantity.value=1):(addToOrderButton.disabled=!1,treeQuantity.disabled=!1,treeQuantity.max=parseInt(standardQuantity.split("q=")[1]),treeQuantity.onchange=function(){this.value<1?this.value=1:this.value>parseInt(standardQuantity.split("q=")[1])&&(this.value=parseInt(standardQuantity.split("q=")[1]))})})}window.addEventListener("loginUpdated",()=>{!async function init(){addEventListeners(),await createTreeImages(),await getProductStockData(),await createStockValues(grades)}()});