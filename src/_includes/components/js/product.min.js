let gradeSizesDiv=document.querySelector("#grade-sizes"),treeBotanicalName=document.querySelector(".tree-botanical-name"),treeCommonName=document.querySelector(".tree-common-name"),images=document.querySelector(".images"),treeAttributes=document.querySelector("#tree-attributes"),imageLightbox=document.querySelector("#image-lightbox"),imageLightboxInner=document.querySelector("#image-lightbox-div"),imageLightBoxClose=document.querySelector("#image-lightbox-close"),thumbImages=document.querySelectorAll(".thumb-image"),productImage="",maximumQuantityReached=!1,productTrees=JSON.parse(sessionStorage.getItem("trees"));const productAdded=new Event("productAdded");let mainImg=document.querySelector(".main-img"),lightboxImage,lightboxImageLow,grades=[],stockData=[],stockListType="retail";async function getProductStockData(){stockData=await fetch("https://sheets.googleapis.com/v4/spreadsheets/1MjWaC2gSJykzoEwj0CvGBjdQF-U4Yu1c4F-tVMU44NQ/values/Sheet1!A2:ZZ9999?key=AIzaSyCRZYs44jejbsBovgiExFgyJBOq0Vkd5uw").then(response=>response.json()).catch(error=>{}),stockData=stockData.values.filter(row=>row[13]===document.body.dataset.code)}async function createStockValues(){if(stockData.length>0){let preOrderRow=null,previousRow=null;for(let i=0;i<stockData.length;i++)if(0!==parseInt(stockData[i][8])||0!==parseInt(stockData[i][9])){let row=document.createElement("tr");if(stockData[i][8]>0){let cell=document.createElement("td"),button=document.createElement("button");button.textContent="Add to order",button.addEventListener("click",()=>{addTreeToSessionStorage(stockData[i][2],stockData[i][6],1,stockData[i][8],stockData[i][7],stockData[i][3],stockData[i][5]),window.dispatchEvent(productAdded),document.body.classList.remove("stock-table-open"),document.body.classList.add("order-open")}),cell.append(button),row.append(cell),preOrderRow?document.querySelector("#order-grades-table-inner").insertBefore(row,preOrderRow):(previousRow?previousRow.after(row):document.querySelector("#order-grades-table-inner").insertAdjacentElement("afterbegin",row),previousRow=row)}else if(stockData[i][9]>0){let cell=document.createElement("td"),orderNow=document.createElement("button");orderNow.textContent="Pre-order",orderNow.addEventListener("click",()=>{document.querySelector("#pre-order-title").innerHTML=stockData[i][2]+" "+treeBotanicalName.innerHTML,document.querySelector("#message-paragraph").innerHTML='<button type="submit" id="send-pre-order">Submit Pre-order</button>',document.body.classList.add("pre-order-open"),document.body.classList.remove("stock-table-open"),document.querySelector("#pre-order-quantity").max=stockData[i][9],document.querySelector("#pre-order-quantity").addEventListener("change",()=>{parseInt(document.querySelector("#pre-order-quantity").value)<1?document.querySelector("#pre-order-quantity").value=1:parseInt(document.querySelector("#pre-order-quantity").value)>stockData[i][9]&&(document.querySelector("#pre-order-quantity").value=stockData[i][9])}),document.querySelector("#pre-grid-content").addEventListener("submit",event=>{event.preventDefault(),document.querySelector("#send-pre-order").textContent="Submitting...";const{name:name,email:email,phone:phone,streetAddress:streetAddress,townCity:townCity,notes:notes,preOrderQuantity:preOrderQuantity}=event.target,internalBody=JSON.stringify({fromAddress:"administrator@leafland.co.nz",fromName:"Admin | Leafland",toAddress:"sales@leafland.co.nz",replyToAddress:email.value,replyToName:name.value,subject:"Pre-order from "+name.value,html:`Hi team,<br><br>I would like to place a pre-order for:<br><br>Tree: ${treeBotanicalName.textContent}<br>Grade: ${stockData[i][2]}<br>Price per tree: ${loggedIn?stockData[i][5]+".00+GST (Wholesale)":stockData[i][3]+".00+GST (Retail)"}<br>Quantity: ${preOrderQuantity.value}<br><br><br>Name: ${name.value}<br>Email: ${email.value}<br>Phone: ${phone.value}<br>Street Address: ${streetAddress.value}<br>Town/City: ${townCity.value}<br>Notes: ${notes.value}`,isOpenTracked:!1}),internalRequestOptions={method:"POST",mode:"no-cors",body:internalBody};!async function(){await fetch("https://internal-order.leafland.co.nz",internalRequestOptions).then(response=>{document.querySelector("#message-paragraph").innerHTML="<p>Thanks for your pre-order! We will be in touch to confirm your pre-order. Payment is done via internet banking and we will email through an invoice for the 50% deposit.</p>"}).catch(error=>{})}()})}),cell.append(orderNow),row.append(cell),document.querySelector("#order-grades-table-inner").insertAdjacentElement("beforeend",row),preOrderRow||(preOrderRow=row)}for(let j=0;j<stockData[i].length;j++)if(0!==j&&1!==j&&4!==j&&j<10){let cell=document.createElement("td");"retail"===stockListType?5!==j&&(""===stockData[i][j].replaceAll('"',"")?cell.textContent="-":cell.textContent=stockData[i][j].replaceAll('"',""),row.append(cell)):3!==j&&(""===stockData[i][j].replaceAll('"',"")?cell.textContent="-":cell.textContent=stockData[i][j].replaceAll('"',""),row.append(cell))}}""===document.querySelector("#order-grades-table-inner").innerHTML&&(document.querySelector("#grade-sizes").innerHTML="<p class='title'>Currently out of stock.</p>")}else document.querySelector("#grade-sizes").innerHTML="<p class='title'>Currently out of stock.</p>"}function addTreeToSessionStorage(grade,averageHeight,quantity,maxQuantity,standardHeight,retailPrice,wholesalePrice){productTrees=JSON.parse(sessionStorage.getItem("trees"));let totalRetailCost=0,totalWholesaleCost=0;if(0===productTrees.length)productTrees.push({botanicalName:treeBotanicalName.innerHTML,commonName:treeCommonName.textContent,url:window.location.pathname,mainImage:productImage,grade:grade,averageHeight:averageHeight,quantity:quantity,maxQuantity:maxQuantity,standardHeight:standardHeight,retailPrice:retailPrice,wholesalePrice:wholesalePrice});else for(let i=0;i<productTrees.length+1;i++){if(i===productTrees.length){productTrees.push({botanicalName:treeBotanicalName.innerHTML,commonName:treeCommonName.textContent,url:window.location.pathname,mainImage:productImage,grade:grade,averageHeight:averageHeight,quantity:quantity,maxQuantity:maxQuantity,standardHeight:standardHeight,retailPrice:retailPrice,wholesalePrice:wholesalePrice});break}if(productTrees[i].quantity=parseInt(productTrees[i].quantity,10),productTrees[i].botanicalName===treeBotanicalName.innerHTML&&productTrees[i].grade===grade&&productTrees[i].averageHeight===averageHeight&&productTrees[i].standardHeight===standardHeight){productTrees[i].quantity+=parseInt(quantity,10),productTrees[i].quantity>=productTrees[i].maxQuantity&&(productTrees[i].quantity=productTrees[i].maxQuantity,maximumQuantityReached=!0);break}}productTrees.forEach(tree=>{totalRetailCost+=tree.quantity*parseInt(tree.retailPrice.slice(1),10),totalWholesaleCost+=tree.quantity*parseInt(tree.wholesalePrice.slice(1),10)}),sessionStorage.setItem("trees",JSON.stringify(productTrees)),sessionStorage.setItem("totalRetailCost",JSON.stringify(totalRetailCost)),sessionStorage.setItem("totalWholesaleCost",JSON.stringify(totalWholesaleCost))}function addEventListeners(){window.addEventListener("storage",(function(event){"trees"===event.key&&(productTrees=JSON.parse(sessionStorage.getItem(event.key)))})),document.querySelector("#open-stock-table").addEventListener("click",()=>{document.body.classList.add("stock-table-open")}),document.querySelector("#stock-table-close").addEventListener("click",()=>{document.body.classList.remove("stock-table-open")}),document.querySelector("#pre-order-close").addEventListener("click",()=>{document.body.classList.remove("pre-order-open")}),document.querySelector("#pre-order-back").addEventListener("click",()=>{document.body.classList.remove("pre-order-open"),document.body.classList.add("stock-table-open")}),imageLightBoxClose.addEventListener("click",()=>{document.body.classList.remove("lightbox-open"),document.querySelector("#next-prev").style.setProperty("display","none"),lightboxImage.src="",lightboxImageLow.src=""});for(let i=0;i<thumbImages.length;i++)thumbImages[i].addEventListener("click",e=>{lightboxImage=document.querySelector("#lightbox-image"),lightboxImageLow=document.querySelector("#lightbox-image-low"),lightboxImage.src="",lightboxImageLow.src="",lightboxImageLow.style.setProperty("display","inline-block"),lightboxImage.style.setProperty("display","none"),document.querySelector("#next-prev").style.setProperty("display","grid"),document.querySelector("#date-taken-div").style.setProperty("display","none"),document.querySelector("#date-taken-div").innerHTML="",lightboxImageLow.src=`https://leafland.co.nz/cdn-cgi/image/format=auto,metadata=none,quality=1,width=1500,blur=100/https://files.leafland.co.nz/${thumbImages[i].src.split("files.leafland.co.nz/")[1]}`,lightboxImageLow.alt=thumbImages[i].alt,lightboxImage.src=`https://leafland.co.nz/cdn-cgi/image/format=auto,metadata=none,quality=85,width=1500/https://files.leafland.co.nz/${thumbImages[i].src.split("files.leafland.co.nz/")[1]}`,lightboxImage.alt=thumbImages[i].alt,lightboxImage.dataset.position=i,document.body.classList.add("lightbox-open")});document.querySelector("#image-lightbox-prev").addEventListener("click",()=>{lightboxImage=document.querySelector("#lightbox-image"),lightboxImageLow=document.querySelector("#lightbox-image-low"),lightboxImage.src="",lightboxImageLow.src="",lightboxImageLow.style.setProperty("display","inline-block"),lightboxImage.style.setProperty("display","none"),0===parseInt(lightboxImage.dataset.position)?(lightboxImageLow.src=`https://leafland.co.nz/cdn-cgi/image/format=auto,metadata=none,quality=1,width=1500,blur=100/https://files.leafland.co.nz/${thumbImages[thumbImages.length-1].src.split("files.leafland.co.nz/")[1]}`,lightboxImageLow.alt=thumbImages[thumbImages.length-1].alt,lightboxImage.src=`https://leafland.co.nz/cdn-cgi/image/format=auto,metadata=none,quality=85,width=1500/https://files.leafland.co.nz/${thumbImages[thumbImages.length-1].src.split("files.leafland.co.nz/")[1]}`,lightboxImage.alt=thumbImages[thumbImages.length-1].alt,lightboxImage.dataset.position=thumbImages.length-1):(lightboxImageLow.src=`https://leafland.co.nz/cdn-cgi/image/format=auto,metadata=none,quality=1,width=1500,blur=100/https://files.leafland.co.nz/${thumbImages[parseInt(lightboxImage.dataset.position)-1].src.split("files.leafland.co.nz/")[1]}`,lightboxImageLow.alt=thumbImages[parseInt(lightboxImage.dataset.position)-1].alt,lightboxImage.src=`https://leafland.co.nz/cdn-cgi/image/format=auto,metadata=none,quality=85,width=1500/https://files.leafland.co.nz/${thumbImages[parseInt(lightboxImage.dataset.position)-1].src.split("files.leafland.co.nz/")[1]}`,lightboxImage.alt=thumbImages[parseInt(lightboxImage.dataset.position)-1].alt,lightboxImage.dataset.position=parseInt(lightboxImage.dataset.position)-1)}),document.querySelector("#image-lightbox-next").addEventListener("click",()=>{lightboxImage=document.querySelector("#lightbox-image"),lightboxImageLow=document.querySelector("#lightbox-image-low"),lightboxImage.src="",lightboxImageLow.src="",lightboxImageLow.style.setProperty("display","inline-block"),lightboxImage.style.setProperty("display","none"),parseInt(lightboxImage.dataset.position)===thumbImages.length-1?(lightboxImageLow.src=`https://leafland.co.nz/cdn-cgi/image/format=auto,metadata=none,quality=1,width=1500,blur=100/https://files.leafland.co.nz/${thumbImages[0].src.split("files.leafland.co.nz/")[1]}`,lightboxImageLow.alt=thumbImages[0].alt,lightboxImage.src=`https://leafland.co.nz/cdn-cgi/image/format=auto,metadata=none,quality=85,width=1500/https://files.leafland.co.nz/${thumbImages[0].src.split("files.leafland.co.nz/")[1]}`,lightboxImage.alt=thumbImages[0].alt,lightboxImage.dataset.position=0):(lightboxImageLow.src=`https://leafland.co.nz/cdn-cgi/image/format=auto,metadata=none,quality=1,width=1500,blur=100/https://files.leafland.co.nz/${thumbImages[parseInt(lightboxImage.dataset.position)+1].src.split("files.leafland.co.nz/")[1]}`,lightboxImageLow.alt=thumbImages[parseInt(lightboxImage.dataset.position)+1].alt,lightboxImage.src=`https://leafland.co.nz/cdn-cgi/image/format=auto,metadata=none,quality=85,width=1500/https://files.leafland.co.nz/${thumbImages[parseInt(lightboxImage.dataset.position)+1].src.split("files.leafland.co.nz/")[1]}`,lightboxImage.alt=thumbImages[parseInt(lightboxImage.dataset.position)+1].alt,lightboxImage.dataset.position=parseInt(lightboxImage.dataset.position)+1)}),document.querySelectorAll(".grade-size-div").forEach(gradeImage=>gradeImage.addEventListener("click",()=>{document.querySelector("#date-taken-div").innerHTML="",document.querySelector("#date-taken-div").style.setProperty("display","inline-block"),lightboxImage=document.querySelector("#lightbox-image"),lightboxImageLow=document.querySelector("#lightbox-image-low"),lightboxImage.src="",lightboxImageLow.src="",lightboxImageLow.style.setProperty("display","inline-block"),lightboxImage.style.setProperty("display","none");let info=gradeImage.dataset.info.split("&");lightboxImageLow.src=`https://leafland.co.nz/cdn-cgi/image/format=auto,metadata=none,quality=1,width=1500,blur=100/https://files.leafland.co.nz/${info[0]}`,lightboxImageLow.alt=info[1],lightboxImage.src=`https://leafland.co.nz/cdn-cgi/image/format=auto,metadata=none,quality=75,width=1500/https://files.leafland.co.nz/${info[0]}`,lightboxImage.alt=info[1],document.body.classList.add("lightbox-open"),imageLightbox.style.setProperty("z-index","9"),document.querySelector("#date-taken-div").innerHTML=`<span id="date-taken" style="font-weight:600">${info[3]} in ${info[2]}</span>`}))}loggedIn&&(stockListType="wholesale",document.querySelector("#grade-price").textContent="$Wholesale"),async function init(){document.querySelector("#grade-size-images").firstElementChild&&document.querySelector("#grade-size-image-div").style.setProperty("display","grid"),addEventListeners(),productImage=mainImg.src.split("files.leafland.co.nz/")[1],await getProductStockData(),await createStockValues(),document.querySelector("#grade-sizes").style.setProperty("display","grid")}();