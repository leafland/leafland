const submitForm=document.querySelector(".submit-form"),treesField=document.querySelector("#trees"),send=document.querySelector(".send-order"),treesDisplay=document.querySelector("#form-trees");let gridContentRight=document.querySelector("#grid-content-right"),region=document.querySelector("#region"),emptyMessage=document.querySelector("#empty-message"),submitOrderTrees=JSON.parse(sessionStorage.getItem("trees")),total,freightTotal=document.querySelector("#freight-total"),treeTotal=document.querySelector("#tree-total"),orderTotal=document.querySelector("#order-total");async function populateForm(){let totalFreight=0,freightRegion=[],minimumCharge="";"Northland"!==region.value&&"Manawatu"!==region.value&&"Gisborne"!==region.value&&"pickup"!==region.value.toLowerCase()&&orderFreightData.forEach(datum=>{datum[0]===region.value&&(freightRegion.push({grade:datum[1],price:datum[2]}),"Minimum"===datum[1]&&(minimumCharge=datum[2]))}),totalRetailCost=sessionStorage.getItem("totalRetailCost"),totalWholesaleCost=sessionStorage.getItem("totalWholesaleCost"),total=loggedIn?totalWholesaleCost:totalRetailCost,treesDisplay.innerHTML="",treesField.value="";let title=document.createElement("p");title.classList.add("form-trees-title"),title.textContent="Trees:";let poaGrade=!1;submitOrderTrees.forEach(tree=>{let freightPriceValue="";if("Northland"!==region.value&&"Manawatu"!==region.value&&"Gisborne"!==region.value&&"pickup"!==region.value.toLowerCase())for(i=0;i<freightRegion.length;i++)if(-1!==freightRegion[i].grade.search(tree.grade)){freightPriceValue=freightRegion[i].price;break}let formTree=document.createElement("div");formTree.classList.add("form-tree");let formTreeLeft=document.createElement("div");formTreeLeft.classList.add("form-tree-left");let treeNameDiv=document.createElement("div");treeNameDiv.classList.add("tree-name");let treeUrlBotanical=document.createElement("a");treeUrlBotanical.href=tree.url,treeUrlBotanical.innerHTML=tree.botanicalName;let botanicalName=document.createElement("p");if(botanicalName.classList.add("botanical-name"),botanicalName.appendChild(treeUrlBotanical),treeNameDiv.appendChild(botanicalName),""!==tree.commonName){let treeUrlCommon=document.createElement("a");treeUrlCommon.href=tree.url,treeUrlCommon.textContent=tree.commonName,treeUrlCommon.classList.add("common-name"),treeNameDiv.appendChild(treeUrlCommon)}let treeInfoDiv=document.createElement("div");treeInfoDiv.classList.add("tree-info");let gradeSize=document.createElement("p");gradeSize.innerHTML=`Grade Size: <span class="accent-color">${tree.grade}</span>`;let averageHeight=document.createElement("p");averageHeight.innerHTML=`Height: <span class="accent-color">${"n/a"===tree.averageHeight.toLowerCase()?tree.averageHeight:tree.averageHeight+"<span class='lowercase'>m</span>"}</span>`;let standardHeight=document.createElement("p");standardHeight.innerHTML=`Standard Height: <span class="accent-color">${"none"===tree.standardHeight.toLowerCase()?tree.standardHeight:tree.standardHeight+"<span class='lowercase'>m</span>"}</span>`;let quantity=document.createElement("p");quantity.innerHTML=`Quantity: <span class="accent-color">${tree.quantity}</span>`;let price=document.createElement("p");price.innerHTML=`Price per tree: <span class="accent-color">${loggedIn?tree.wholesalePrice+"+GST (Wholesale)":tree.retailPrice+"+GST (Retail)"}</span>`;let freightPrice=document.createElement("p");treeInfoDiv.appendChild(gradeSize),treeInfoDiv.appendChild(averageHeight),treeInfoDiv.appendChild(standardHeight),treeInfoDiv.appendChild(quantity),treeInfoDiv.appendChild(price),treeInfoDiv.appendChild(freightPrice),formTreeLeft.appendChild(treeInfoDiv);let formTreeRight=document.createElement("div");formTreeRight.classList.add("form-tree-right");let treeImage=document.createElement("img");treeImage.src=`https://leafland.imgix.net/images/trees/${tree.mainImage}?auto=format&w=300&q=75`,treeImage.alt=`${tree.url.replace(/\/trees\//g,"").replace(/\//g,"").replace(/-/g," ")}`,treeImage.loading="lazy",formTreeRight.appendChild(treeImage),formTree.appendChild(treeNameDiv),formTree.appendChild(formTreeLeft),formTree.appendChild(formTreeRight),treesDisplay.appendChild(formTree),"Northland"!==region.value&&"Manawatu"!==region.value&&"Gisborne"!==region.value&&"Pickup"!==region.value?"P.O.A"===freightPriceValue?(poaGrade=!0,freightPrice.innerHTML='<p>Freight per tree: <span class="accent-color">P.O.A</span></p>',treesField.value+=`<tr style="padding-bottom:3px;margin-bottom:3px;border-bottom:2px solid #000"><td><b>${tree.botanicalName} (${tree.commonName})</b></td> <td><b>${tree.grade}</b></td> <td><b>${"n/a"===tree.averageHeight.toLowerCase()?tree.averageHeight:tree.averageHeight+"m"}</b></td> <td><b>${"none"===tree.standardHeight.toLowerCase()?tree.standardHeight:tree.standardHeight+"m"}</b></td> <td><b>${tree.quantity}</b></td> <td><b>${loggedIn?tree.wholesalePrice+"+GST (Wholesale)":tree.retailPrice+"+GST (Retail)"}</b></td> <td><b>P.O.A</b><td> </tr>`):(freightPrice.innerHTML=`<p>Freight per tree: <span class="accent-color">${freightPriceValue}+GST</span></p>`,treesField.value+=`<tr style="padding-bottom:3px;margin-bottom:3px;border-bottom:2px solid #000"><td><b>${tree.botanicalName} (${tree.commonName})</b></td> <td><b>${tree.grade}</b></td> <td><b>${"n/a"===tree.averageHeight.toLowerCase()?tree.averageHeight:tree.averageHeight+"m"}</b></td> <td><b>${"none"===tree.standardHeight.toLowerCase()?tree.standardHeight:tree.standardHeight+"m"}</b></td> <td><b>${tree.quantity}</b></td> <td><b>${loggedIn?tree.wholesalePrice+"+GST (Wholesale)":tree.retailPrice+"+GST (Retail)"}</b></td> <td><b>${freightPriceValue}+GST</b></td> </tr>`,totalFreight+=parseInt(tree.quantity,10)*parseFloat(freightPriceValue.slice(1))):(freightPrice.innerHTML='<p>Freight per tree: <span class="accent-color">N/A</span></p>',treesField.value+=`<tr style="padding-bottom:3px;margin-bottom:3px;border-bottom:2px solid #000"><td><b>${tree.botanicalName} (${tree.commonName})</b></td> <td><b>${tree.grade}</b></td> <td><b>${"n/a"===tree.averageHeight.toLowerCase()?tree.averageHeight:tree.averageHeight+"m"}</b></td> <td><b>${"none"===tree.standardHeight.toLowerCase()?tree.standardHeight:tree.standardHeight+"m"}</b></td> <td><b>${tree.quantity}</b></td> <td><b>${loggedIn?tree.wholesalePrice+"+GST (Wholesale)":tree.retailPrice+"+GST (Retail)"}</b></td> <td><b>N/A</b></td> </tr>`)}),"Northland"!==region.value&&"Manawatu"!==region.value&&"Gisborne"!==region.value&&"Pickup"!==region.value?(poaGrade?(totalFreight<=parseInt(minimumCharge.slice(1),10)?freightTotal.innerHTML=`Freight Total: <span class="accent-color">${minimumCharge}+GST (minimum freight charge, excluding freight for P.O.A grades)</span>`:freightTotal.innerHTML=`Freight Total: <span class="accent-color">$${totalFreight.toFixed(2)}+GST (excluding freight for P.O.A grades)</span>`,orderTotal.innerHTML=`Order Total: <span class="accent-color">$${-1!==freightTotal.textContent.search("(minimum freight charge)")?(parseInt(total,10)+parseInt(minimumCharge.slice(1),10)).toFixed(2):(parseInt(total,10)+totalFreight).toFixed(2)}+GST (excluding freight for P.O.A grades)</span>`):(totalFreight<=parseInt(minimumCharge.slice(1),10)?freightTotal.innerHTML=`Freight Total: <span class="accent-color">${minimumCharge}+GST (minimum freight charge)</span>`:freightTotal.innerHTML=`Freight Total: <span class="accent-color">$${totalFreight.toFixed(2)}+GST</span>`,orderTotal.innerHTML=`Order Total: <span class="accent-color">$${-1!==freightTotal.textContent.search("(minimum freight charge)")?(parseInt(total,10)+parseInt(minimumCharge.slice(1),10)).toFixed(2):(parseInt(total,10)+totalFreight).toFixed(2)}+GST</span>`),treeTotal.innerHTML=`Tree Total: <span class="accent-color">$${total}.00+GST</span>`):(freightTotal.innerHTML='Freight Total: <span class="accent-color">N/A</span>',treeTotal.innerHTML=`Tree Total: <span class="accent-color">$${parseInt(total,10).toFixed(2)}+GST</span>`,orderTotal.innerHTML=`Order Total: <span class="accent-color">$${parseInt(total,10).toFixed(2)}+GST</span>`)}total=loggedIn?totalWholesaleCost:totalRetailCost,window.addEventListener("loginUpdated",()=>{!async function(){0===submitOrderTrees.length?(submitForm.style.setProperty("display","none"),emptyMessage.style.setProperty("display","block")):await populateForm()}()}),window.addEventListener("storage",event=>{"trees"===event.key&&(submitOrderTrees=JSON.parse(sessionStorage.getItem("trees")),0!==submitOrderTrees.length?(emptyMessage.style.setProperty("display","none"),total=loggedIn?totalWholesaleCost:totalRetailCost,populateForm(),submitForm.style.setProperty("display","grid")):(emptyMessage.style.setProperty("display","block"),submitForm.style.setProperty("display","none")))}),window.addEventListener("orderUpdated",()=>{submitOrderTrees=JSON.parse(sessionStorage.getItem("trees")),0!==submitOrderTrees.length?(emptyMessage.style.setProperty("display","none"),total=loggedIn?totalWholesaleCost:totalRetailCost,populateForm(),submitForm.style.setProperty("display","grid")):(emptyMessage.style.setProperty("display","block"),submitForm.style.setProperty("display","none"))}),region.addEventListener("input",()=>{populateForm()}),submitForm.addEventListener("submit",event=>{event.preventDefault();let freightTotal=document.querySelector("#freight-total"),treeTotal=document.querySelector("#tree-total"),orderTotal=document.querySelector("#order-total");send.textContent="Submitting...",send.style.setProperty("background","var(--primary-text"),send.style.setProperty("color","var(--secondary-background"),send.style.setProperty("cursor","default");const{name:name,email:email,phone:phone,streetAddress:streetAddress,townCity:townCity,returningCustomer:returningCustomer,notes:notes,trees:trees}=event.target,endpoint="https://api.leafland.co.nz/default/send-order-email",body=JSON.stringify({name:name.value,email:email.value,phone:phone.value,streetAddress:streetAddress.value,townCity:townCity.value,returningCustomer:returningCustomer.value,notes:notes.value,trees:trees.value,freightRegion:region.value,freightTotal:freightTotal.innerHTML.replace(/Freight Total: <span class="accent-color">/,"").replace(/<\/span>/,""),treeTotal:treeTotal.innerHTML.replace(/Tree Total: <span class="accent-color">/,"").replace(/<\/span>/,""),orderTotal:orderTotal.innerHTML.replace(/Order Total: <span class="accent-color">/,"").replace(/<\/span>/,"")}),requestOptions={method:"POST",body:body};!async function(){await fetch(endpoint,requestOptions).then(response=>{}).catch(error=>{}),sessionStorage.setItem("submittedOrder","true"),window.location.reload()}()}),document.querySelector("#close-submit-order").addEventListener("click",()=>{document.body.classList.remove("submit-order-open")}),document.querySelector("#submit-order-back").addEventListener("click",()=>{document.body.classList.remove("submit-order-open"),document.body.classList.add("order-open")});