function updateOrderTotal(){loggedIn?totalCostText.innerHTML=`Total: <span class="accent-color">$${totalWholesaleCost}.00+GST (excluding freight)</span>`:totalCostText.innerHTML=`Total: <span class="accent-color">$${totalRetailCost}.00+GST (excluding freight)</span>`}function displayEmptyOrder(){orderContent.contains(productList)&&orderContent.removeChild(productList),orderContent.innerHTML="";let e=document.createElement("p");e.textContent="No trees in order.",e.classList.add("empty-message"),e.classList.add("paragraph-title"),orderContent.appendChild(e),totalCostText.style.setProperty("visibility","hidden"),localStorage.setItem("totalRetailCost","0"),localStorage.setItem("totalWholesaleCost","0"),submitOrder.classList.add("disabled")}async function getOrderImages(){orderImageData=await fetch("https://api.leafland.co.nz/default/get-image-data").then(e=>e.json()).then(e=>e).catch(e=>{})}async function updateOrder(){if(orderTrees=JSON.parse(localStorage.getItem("trees")),0!==orderTrees.length){totalRetailCost=localStorage.getItem("totalRetailCost"),totalWholesaleCost=localStorage.getItem("totalWholesaleCost"),totalCostText.style.setProperty("visibility","visible");let e=document.querySelector(".empty-message");orderContent.contains(e)&&orderContent.removeChild(e),submitOrder.classList.remove("disabled"),productList.innerHTML="",orderTrees.forEach(e=>{let t=[];for(let a=0;a<orderImageData.length;a++)orderImageData[a].split("/",4)[3]!==`${e.url.slice(0,e.url.length-1).split(/\/trees\//)[1]}.jpg`&&orderImageData[a].split("/",4)[3]!==`${e.url.slice(0,e.url.length-1).split(/\/trees\//)[1]}.jpeg`||t.push(orderImageData[a]);let a=document.createElement("li");a.classList.add("order-product");let r=document.createElement("div");r.classList.add("order-product-left");let o=document.createElement("div");o.classList.add("order-product-right");let d=document.createElement("img");d.src=`https://ik.imagekit.io/leafland/${t[t.length-1]}?tr=w-300,q-75,pr-true,f-auto`,d.width="300",d.height="300",d.loading="lazy";let l=document.createElement("h2");l.innerHTML=`<a href='${e.url}'>${e.botanicalName}</a>`,l.classList.add("order-botanical-name");let s=document.createElement("div");if(s.classList.add("order-product-name"),s.appendChild(l),""!==e.commonName){let t=document.createElement("h3");t.innerHTML=`<a href='${e.url}' class="accent-color">${e.commonName}</a>`,t.classList.add("order-common-name"),s.appendChild(t)}let n=document.createElement("p");n.innerHTML=`Grade Size: <span class="accent-color">${e.grade}</span>`;let c=document.createElement("p");c.innerHTML=`Average Height: <span class="accent-color">${"n/a"===e.averageHeight.toLowerCase()?e.averageHeight:e.averageHeight+"<span class='lowercase'>m</span>"}</span>`;let p=document.createElement("p");null!==e.standardHeight.match(/\d+/g)?p.innerHTML=`Standard Height: <span class="accent-color">${e.standardHeight+"<span class='lowercase'>m</span>"}</span>`:p.innerHTML=`Standard Height: <span class="accent-color">${e.standardHeight}</span>`;let g=document.createElement("p");loggedIn?g.innerHTML=`Price: <span class="accent-color">${e.wholesalePrice}+GST (Wholesale)</span>`:g.innerHTML=`Price: <span class="accent-color">${e.retailPrice}+GST (Retail)</span>`;let u=document.createElement("input");u.type="number",u.value=e.quantity,u.min="1",u.max=e.maxQuantity,u.inputMode="numeric",u.classList.add("order-quantity"),u.dataset.grade=e.grade,u.dataset.height=e.averageHeight,u.dataset.standardHeight=e.standardHeight,u.addEventListener("change",()=>{parseInt(u.value)<1?u.value=1:parseInt(u.value)>parseInt(e.maxQuantity)&&(u.value=parseInt(e.maxQuantity));for(let t=0;t<orderTrees.length;t++)if(orderTrees[t].botanicalName===e.botanicalName&&orderTrees[t].grade===u.dataset.grade&&orderTrees[t].averageHeight===u.dataset.height&&orderTrees[t].standardHeight===u.dataset.standardHeight){orderTrees[t].quantity=u.value;break}for(totalWholesaleCost=0,totalRetailCost=0,i=0;i<orderTrees.length;i++)totalWholesaleCost+=orderTrees[i].quantity*parseInt(orderTrees[i].wholesalePrice.slice(1),10),totalRetailCost+=orderTrees[i].quantity*parseInt(orderTrees[i].retailPrice.slice(1),10);updateOrderTotal(),updateStorage(),window.dispatchEvent(orderUpdated)}),u.addEventListener("input",()=>{for(let t=0;t<orderTrees.length;t++)if(orderTrees[t].botanicalName===e.botanicalName&&orderTrees[t].grade===u.dataset.grade&&orderTrees[t].averageHeight===u.dataset.height&&orderTrees[t].standardHeight===u.dataset.standardHeight){orderTrees[t].quantity=u.value;break}for(totalWholesaleCost=0,totalRetailCost=0,i=0;i<orderTrees.length;i++)totalWholesaleCost+=orderTrees[i].quantity*parseInt(orderTrees[i].wholesalePrice.slice(1),10),totalRetailCost+=orderTrees[i].quantity*parseInt(orderTrees[i].retailPrice.slice(1),10);updateOrderTotal(),updateStorage(),window.dispatchEvent(orderUpdated)});let m=document.createElement("button");m.textContent="Remove",m.classList.add("remove-item"),m.addEventListener("click",()=>{for(let t=0;t<orderTrees.length;t++)if(orderTrees[t].botanicalName===e.botanicalName&&orderTrees[t].grade===u.dataset.grade&&orderTrees[t].averageHeight===u.dataset.height&&orderTrees[t].standardHeight===u.dataset.standardHeight){orderTrees.splice(t,1);break}for(totalWholesaleCost=0,totalRetailCost=0,i=0;i<orderTrees.length;i++)totalWholesaleCost+=orderTrees[i].quantity*parseInt(orderTrees[i].wholesalePrice.slice(1),10),totalRetailCost+=orderTrees[i].quantity*parseInt(orderTrees[i].retailPrice.slice(1),10);updateStorage(),updateOrder(),window.dispatchEvent(orderUpdated)}),r.appendChild(s),r.appendChild(n),r.appendChild(c),r.appendChild(p),r.appendChild(g),r.appendChild(u),r.appendChild(m),o.appendChild(d),a.appendChild(r),a.appendChild(o),productList.appendChild(a)}),orderContent.appendChild(productList),updateOrderTotal()}else displayEmptyOrder();window.dispatchEvent(orderUpdated)}function updateStorage(){localStorage.setItem("trees",JSON.stringify(orderTrees)),localStorage.setItem("totalRetailCost",JSON.stringify(totalRetailCost)),localStorage.setItem("totalWholesaleCost",JSON.stringify(totalWholesaleCost))}let orderContent=document.querySelector("#order-content"),openOrder=document.querySelector("#open-order"),closeOrder=document.querySelector("#close-order"),submitOrder=document.querySelector("#submit-order"),totalCostText=document.querySelector("#order-overlay-total"),productList=document.createElement("ul");productList.classList.add("order-product-list");const orderUpdated=new Event("orderUpdated");let orderTrees,orderImageData=[],totalRetailCost=localStorage.getItem("totalRetailCost"),totalWholesaleCost=localStorage.getItem("totalWholesaleCost");openOrder.addEventListener("click",()=>{document.body.classList.add("order-open")}),closeOrder.addEventListener("click",()=>{document.body.classList.remove("order-open")}),window.addEventListener("storage",()=>{"true"===localStorage.getItem("loggedIn")?loggedIn=!0:loggedIn=!1,updateOrder()}),window.addEventListener("productAdded",()=>{updateOrder()}),window.addEventListener("loginUpdated",()=>{(async function(){await getOrderImages(),updateOrder()})()});