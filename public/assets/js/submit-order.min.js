async function getFreightData(){freightData=await fetch("https://api.leafland.co.nz/default/get-freight-data-file").then(e=>e.json()).catch(e=>{})}async function getSubmitOrderImages(){submitOrderImages=await fetch("https://api.leafland.co.nz/default/get-image-data").then(e=>e.json()).then(e=>e).catch(e=>{})}async function populateForm(){let e=0,t=[],a="";"Northland"!==region.value&&"Manawatu"!==region.value&&"pickup"!==region.value.toLowerCase()&&freightData.forEach(e=>{e[0]===region.value&&(t.push({grade:e[1],price:e[2]}),"Minimum"===e[1]&&(a=e[2]))}),totalRetailCost=localStorage.getItem("totalRetailCost"),totalWholesaleCost=localStorage.getItem("totalWholesaleCost"),total=loggedIn?totalWholesaleCost:totalRetailCost,treesDisplay.innerHTML="",treesField.value="";let r=document.createElement("p");r.classList.add("form-trees-title"),r.textContent="Trees:";let o=!1;submitOrderTrees.forEach(a=>{let r=[];for(let e=0;e<submitOrderImages.length;e++)submitOrderImages[e].split("/",4)[3]!==`${a.url.slice(0,a.url.length-1).split(/\/trees\//)[1]}.jpg`&&submitOrderImages[e].split("/",4)[3]!==`${a.url.slice(0,a.url.length-1).split(/\/trees\//)[1]}.jpeg`||r.push(submitOrderImages[e]);let n="";if("Northland"!==region.value&&"Manawatu"!==region.value&&"pickup"!==region.value.toLowerCase())for(i=0;i<t.length;i++)if(-1!==t[i].grade.search(a.grade)){n=t[i].price;break}let l=document.createElement("div");l.classList.add("form-tree");let s=document.createElement("div");s.classList.add("form-tree-left");let d=document.createElement("div");d.classList.add("tree-name");let c=document.createElement("a");c.href=a.url;let p=document.createElement("h2");if(p.textContent=a.botanicalName,p.classList.add("botanical-name"),c.appendChild(p),d.appendChild(c),""!==a.commonName){let e=document.createElement("a");e.href=a.url;let t=document.createElement("h2");t.textContent=a.commonName,t.classList.add("common-name"),t.classList.add("accent-color"),e.appendChild(t),d.appendChild(e)}s.appendChild(d);let g=document.createElement("div");g.classList.add("tree-info");let m=document.createElement("p");m.innerHTML=`Grade size: <span class="accent-color">${a.grade}</span>`;let u=document.createElement("p");u.innerHTML=`Average height: <span class="accent-color">${"n/a"===a.averageHeight.toLowerCase()?a.averageHeight:a.averageHeight+"<span class='lowercase'>m</span>"}</span>`;let h=document.createElement("p");h.innerHTML=`Standard height: <span class="accent-color">${"none"===a.standardHeight.toLowerCase()?a.standardHeight:a.standardHeight+"<span class='lowercase'>m</span>"}</span>`;let b=document.createElement("p");b.innerHTML=`Quantity: <span class="accent-color">${a.quantity}</span>`;let y=document.createElement("p");y.innerHTML=`Price per tree: <span class="accent-color">${loggedIn?a.wholesalePrice+"+GST (Wholesale)":a.retailPrice+"+GST (Retail)"}</span>`;let T=document.createElement("p");g.appendChild(m),g.appendChild(u),g.appendChild(h),g.appendChild(b),g.appendChild(y),g.appendChild(T),s.appendChild(g);let f=document.createElement("div");f.classList.add("form-tree-right");let v=document.createElement("img");v.src=`https://ik.imagekit.io/leafland/${r[r.length-1]}?tr=w-300,q-75,pr-true,f-auto`,v.loading="lazy",f.appendChild(v),l.appendChild(s),l.appendChild(f),treesDisplay.appendChild(l),"Northland"!==region.value&&"Manawatu"!==region.value&&"Pickup"!==region.value?"P.O.A"===n?(o=!0,T.innerHTML='<p>Freight per tree: <span class="accent-color">P.O.A</span></p>',treesField.value+=`<p style="padding-bottom:3px;margin-bottom:3px;border-bottom:2px solid #000"><b>${a.botanicalName.toUpperCase()} (${a.commonName.toUpperCase()})</b> || Grade: <b>${a.grade}</b> || Average Height: <b>${"n/a"===a.averageHeight.toLowerCase()?a.averageHeight:a.averageHeight+"m"}</b> || Standard Height: <b>${"none"===a.standardHeight.toLowerCase()?a.standardHeight:a.standardHeight+"m"}</b> || Quantity: <b>${a.quantity}</b> || Price per tree: <b>${loggedIn?a.wholesalePrice+"+GST (Wholesale)":a.retailPrice+"+GST (Retail)"}</b> || Freight per tree: <b>P.O.A</b> </p><br>`):(T.innerHTML=`<p>Freight per tree: <span class="accent-color">${n}+GST</span></p>`,treesField.value+=`<p style="padding-bottom:3px;margin-bottom:3px;border-bottom:2px solid #000"><b>${a.botanicalName.toUpperCase()} (${a.commonName.toUpperCase()})</b> || Grade: <b>${a.grade}</b> || Average Height: <b>${"n/a"===a.averageHeight.toLowerCase()?a.averageHeight:a.averageHeight+"m"}</b> || Standard Height: <b>${"none"===a.standardHeight.toLowerCase()?a.standardHeight:a.standardHeight+"m"}</b> || Quantity: <b>${a.quantity}</b> || Price per tree: <b>${loggedIn?a.wholesalePrice+"+GST (Wholesale)":a.retailPrice+"+GST (Retail)"}</b> || Freight per tree: <b>${n}+GST</b> </p><br>`,e+=parseInt(a.quantity,10)*parseFloat(n.slice(1))):(T.innerHTML='<p>Freight per tree: <span class="accent-color">N/A</span></p>',treesField.value+=`<p style="padding-bottom:3px;margin-bottom:3px;border-bottom:2px solid #000"><b>${a.botanicalName.toUpperCase()} (${a.commonName.toUpperCase()})</b> || Grade: <b>${a.grade}</b> || Average Height: <b>${"n/a"===a.averageHeight.toLowerCase()?a.averageHeight:a.averageHeight+"m"}</b> || Standard Height: <b>${"none"===a.standardHeight.toLowerCase()?a.standardHeight:a.standardHeight+"m"}</b> || Quantity: <b>${a.quantity}</b> || Price per tree: <b>${loggedIn?a.wholesalePrice+"+GST (Wholesale)":a.retailPrice+"+GST (Retail)"}</b> || Freight per tree: <b>N/A</b> </p><br>`)}),"Northland"!==region.value&&"Manawatu"!==region.value&&"Pickup"!==region.value?(o?(e<=parseInt(a.slice(1),10)?freightTotal.innerHTML=`Freight total: <span class="accent-color">${a}+GST (Minimum freight charge, excluding freight for P.O.A grades)</span>`:freightTotal.innerHTML=`Freight total: <span class="accent-color">$${e.toFixed(2)}+GST (excluding freight for P.O.A grades)</span>`,orderTotal.innerHTML=`Order total: <span class="accent-color">$${-1!==freightTotal.textContent.search("(Minimum freight charge)")?(parseInt(total,10)+parseInt(a.slice(1),10)).toFixed(2):(parseInt(total,10)+e).toFixed(2)}+GST (excluding freight for P.O.A grades)</span>`):(e<=parseInt(a.slice(1),10)?freightTotal.innerHTML=`Freight total: <span class="accent-color">${a}+GST (Minimum freight charge)</span>`:freightTotal.innerHTML=`Freight total: <span class="accent-color">$${e.toFixed(2)}+GST</span>`,orderTotal.innerHTML=`Order total: <span class="accent-color">$${-1!==freightTotal.textContent.search("(Minimum freight charge)")?(parseInt(total,10)+parseInt(a.slice(1),10)).toFixed(2):(parseInt(total,10)+e).toFixed(2)}+GST</span>`),treeTotal.innerHTML=`Tree total: <span class="accent-color">$${total}.00+GST</span>`):(freightTotal.innerHTML='Freight total: <span class="accent-color">N/A</span>',treeTotal.innerHTML=`Tree total: <span class="accent-color">$${parseInt(total,10).toFixed(2)}+GST</span>`,orderTotal.innerHTML=`Order total: <span class="accent-color">$${parseInt(total,10).toFixed(2)}+GST</span>`)}const submitForm=document.querySelector(".submit-form"),treesField=document.querySelector("#trees"),send=document.querySelector(".send-order"),treesDisplay=document.querySelector("#form-trees");let total,gridContentRight=document.querySelector("#grid-content-right"),region=document.querySelector("#region"),emptyMessage=document.querySelector("#empty-message"),freightData=[],submitOrderImages=[],submitOrderTrees=JSON.parse(localStorage.getItem("trees")),freightTotal=document.querySelector("#freight-total"),treeTotal=document.querySelector("#tree-total"),orderTotal=document.querySelector("#order-total");total=loggedIn?totalWholesaleCost:totalRetailCost,window.addEventListener("loginUpdated",()=>{(async function(){0===submitOrderTrees.length?(submitForm.style.setProperty("display","none"),emptyMessage.style.setProperty("display","block")):(await getSubmitOrderImages(),await getFreightData(),await populateForm(),document.body.classList.add("page-loaded"))})()}),send.addEventListener("click",()=>{localStorage.removeItem("trees")}),window.addEventListener("storage",e=>{"trees"===e.key&&(submitOrderTrees=JSON.parse(localStorage.getItem("trees")),0!==submitOrderTrees.length?(emptyMessage.style.setProperty("display","none"),total=loggedIn?totalWholesaleCost:totalRetailCost,populateForm(),submitForm.style.setProperty("display","grid")):(emptyMessage.style.setProperty("display","block"),submitForm.style.setProperty("display","none")))}),window.addEventListener("orderUpdated",()=>{submitOrderTrees=JSON.parse(localStorage.getItem("trees")),0!==submitOrderTrees.length?(emptyMessage.style.setProperty("display","none"),total=loggedIn?totalWholesaleCost:totalRetailCost,populateForm(),submitForm.style.setProperty("display","grid")):(emptyMessage.style.setProperty("display","block"),submitForm.style.setProperty("display","none"))}),region.addEventListener("input",()=>{populateForm()}),submitForm.addEventListener("submit",e=>{e.preventDefault();let t=document.querySelector("#freight-total"),a=document.querySelector("#tree-total"),r=document.querySelector("#order-total");send.textContent="Submitting...",send.style.setProperty("background","var(--primary-text"),send.style.setProperty("color","var(--secondary-background"),send.style.setProperty("cursor","default");const{name:o,email:n,phone:l,streetAddress:s,townCity:i,returningCustomer:d,notes:c,trees:p}=e.target,g="https://api.leafland.co.nz/default/send-order-email",m=JSON.stringify({name:o.value,email:n.value,phone:l.value,streetAddress:s.value,townCity:i.value,returningCustomer:d.value,notes:c.value,trees:p.value,freightRegion:region.value,freightTotal:t.innerHTML.replace(/Freight total: <span class="accent-color">/,"").replace(/<\/span>/,""),treeTotal:a.innerHTML.replace(/Tree total: <span class="accent-color">/,"").replace(/<\/span>/,""),orderTotal:r.innerHTML.replace(/Order total: <span class="accent-color">/,"").replace(/<\/span>/,"")}),u={method:"POST",body:m};(async function(){await fetch(g,u).then(e=>{}).catch(e=>{}),document.body.querySelector("#content").innerHTML="<h1>Thanks for your order!</h1><p>From here, we will process your order and confirm we can supply the trees and grades you are after. We will also double-check the freight and let you know if there will be any extra costs (like a surcharge for rural addresses). Then we will send you an invoice that will have our bank details on for payment. We do not take payment via any sort of card.</p>"})()});