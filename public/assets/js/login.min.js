async function logIn(e){document.querySelector("#log-in").value="Logging in...",login=await fetch(`https://api.leafland.co.nz/default/supabase-login?email=${e.target[0].value}`).then(e=>e.text()).catch(e=>{})}async function checkToken(e){login=await fetch(`https://api.leafland.co.nz/default/check-token${e}`).then(e=>e.text()).catch(e=>{})}async function sendLoginLink(e){const t="https://api.leafland.co.nz/default/send-login-link",o=JSON.stringify({email:e.target[0].value,loginPage:window.location.href}),n={method:"POST",body:o};fetch(t,n).then(e=>{}).catch(e=>{})}let loginForm=document.querySelector("#login-form"),returnMessage=document.querySelector("#return-message"),logOutButton=document.querySelector("#log-out"),login="",openLogin=document.querySelector("#open-login"),closeLogin=document.querySelector("#close-login");loginForm.addEventListener("submit",e=>{e.preventDefault(),localStorage.setItem("loginPage",`${window.location.href}`),async function(){await logIn(e),"false"===login?(returnMessage.textContent="Invalid email address. Please try again.",document.querySelector("#log-in").value="Log in",document.querySelector("#log-in").disabled=!1,localStorage.setItem("loggedIn","false")):(await sendLoginLink(e),returnMessage.textContent="Check your inbox for the login link.",document.querySelector("#log-in").value="Log in",document.querySelector("#log-in").disabled=!0)}()}),window.addEventListener("DOMContentLoaded",()=>{let e=new Event("loginUpdated"),t=window.location.search;t.length>0?async function(){await checkToken(t),"true"===login?(localStorage.setItem("loggedIn","true"),null===localStorage.getItem("reloaded")?(window.history.replaceState(null,null,window.location.pathname),localStorage.setItem("reloaded","true")):"false"===localStorage.getItem("reloaded")&&(window.history.replaceState(null,null,window.location.pathname),localStorage.setItem("reloaded","true"))):(localStorage.setItem("loggedIn","false"),localStorage.setItem("reloaded","false")),window.dispatchEvent(e)}():window.dispatchEvent(e)}),openLogin.addEventListener("click",()=>{document.querySelector("#log-in").disabled=!1,returnMessage.textContent="",document.body.classList.add("login-open")}),closeLogin.addEventListener("click",()=>{document.body.classList.remove("login-open")}),logOutButton.addEventListener("click",()=>{localStorage.setItem("loggedIn","false"),localStorage.setItem("reloaded","false"),window.location.reload()});